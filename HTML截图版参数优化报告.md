# HTML 截图版参数优化报告

## 🔍 问题分析

### 发现的问题

#### 1. ❌ 文档标题参数未被使用
**问题**：用户配置的"文档标题"参数被忽略，实际使用的是文件名。

**影响**：用户无法自定义 HTML 文档标题。

#### 2. ❌ 字体大小无法配置
**问题**：HTML 模式的字体大小固定为 14pt，用户无法调整。

**影响**：用户无法根据需求调整讲解文字大小。

#### 3. ⚠️ 参数布局不够紧凑
**问题**：参数全部垂直排列，占用较多空间。

**影响**：需要更多滚动操作。

---

## ✅ 已实施的改进

### 1. 修复文档标题功能

**修改文件**：
- `app/ui_helpers.py`（第 246、279 行）
- `app/streamlit_app.py`（第 803-804 行）

**改进内容**：
```python
# 使用用户配置的标题，如果为空则使用文件名
title = params.get("markdown_title", "").strip() or base_name
```

**用户体验**：
- ✅ 现在用户配置的标题会被正确使用
- ✅ 如果留空，自动使用文件名作为回退
- ✅ 批量处理时每个文件可以有独立标题（使用文件名）

---

### 2. 添加字体大小配置

**修改文件**：`app/streamlit_app.py`（第 91 行）

**新增配置**：
```python
font_size = st.number_input(
    "讲解字体大小", 
    min_value=10, 
    max_value=24, 
    value=14, 
    step=1, 
    help="讲解文字的字体大小"
)
```

**用户体验**：
- ✅ 用户可以调整 10pt-24pt 之间的字体大小
- ✅ 默认值 14pt 保持不变
- ✅ 与其他参数布局一致

---

### 3. 优化参数布局

**修改文件**：`app/streamlit_app.py`（第 87-97 行）

**新布局**：
```python
col1, col2 = st.columns(2)
with col1:
    screenshot_dpi = st.slider("截图DPI", ...)
with col2:
    font_size = st.number_input("讲解字体大小", ...)

col1, col2 = st.columns(2)
with col1:
    html_column_count = st.slider("分栏数量", ...)
with col2:
    html_column_gap = st.slider("栏间距(px)", ...)

html_show_column_rule = st.checkbox("显示栏间分隔线", ...)
markdown_title = st.text_input("文档标题", ...)
```

**用户体验**：
- ✅ 相关参数并排显示，节省垂直空间
- ✅ 减少滚动需求
- ✅ 视觉更清晰

---

### 4. 改进帮助文本

**修改**：
```python
markdown_title = st.text_input(
    "文档标题", 
    value="PDF文档讲解", 
    help="HTML文档的标题（留空则使用文件名）"  # 新增说明
)
```

**用户体验**：
- ✅ 明确说明留空时的行为
- ✅ 用户知道可以依赖默认值

---

## 📊 改进前后对比

### 改进前
```
🌐 HTML 截图版参数
├─ 截图DPI（滑块）
├─ 分栏数量（滑块）
├─ 栏间距（滑块）
├─ 显示栏间分隔线（复选框）
└─ 文档标题（文本框）❌ 不生效

实际使用：
- 字体大小：14pt（硬编码，无法调整）
- 文档标题：文件名（忽略用户配置）
```

### 改进后
```
🌐 HTML 截图版参数
├─ [截图DPI | 讲解字体大小]（列布局）✅
├─ [分栏数量 | 栏间距]（列布局）✅
├─ 显示栏间分隔线（复选框）
└─ 文档标题（文本框，留空使用文件名）✅

实际使用：
- 字体大小：10-24pt（用户可调）✅
- 文档标题：用户配置或文件名（正确使用）✅
```

---

## 🎯 HTML 截图版最终参数列表

### 可配置参数（共 6 个）

1. **截图DPI** (72-300, 默认 150)
   - 控制 PDF 截图质量
   - 影响图片清晰度和文件大小

2. **讲解字体大小** (10-24pt, 默认 14)
   - 控制讲解文字大小
   - 影响阅读体验

3. **分栏数量** (1-3, 默认 2)
   - 控制讲解内容分栏
   - 类似 Word 的分栏排版

4. **栏间距** (10-40px, 默认 20)
   - 控制分栏之间的间距
   - 影响视觉舒适度

5. **显示栏间分隔线** (默认开启)
   - 在分栏之间显示分隔线
   - 增强视觉区分

6. **文档标题** (默认"PDF文档讲解")
   - HTML 文档的标题
   - 留空则使用文件名

### 自动使用的参数

- **字体名称**：从全局"CJK 字体"配置获取
- **行距**：从全局"讲解文本行距"配置获取
- **图片嵌入**：始终为 true（单文件方便分享）

---

## 🔧 技术实现细节

### 参数传递流程

```
用户配置（streamlit_app.py）
    ↓
params 字典
    ↓
process_single_file_html_screenshot（ui_helpers.py）
    ↓
generate_html_screenshot_document（pdf_processor.py）
    ↓
HTMLScreenshotGenerator（html_screenshot_generator.py）
```

### 标题处理逻辑

```python
# 获取文件名（不含扩展名）
base_name = filename.rsplit('.', 1)[0] if '.' in filename else filename

# 使用用户配置的标题，如果为空则回退到文件名
title = params.get("markdown_title", "").strip() or base_name
```

**优势**：
- 批量处理时，每个文件自动使用文件名
- 单独配置时，可以使用统一标题
- 灵活且用户友好

---

## ✅ 验证和测试

### 修改文件清单
1. `app/streamlit_app.py` - 前端配置和批量处理
2. `app/ui_helpers.py` - 单文件处理逻辑

### Linter 检查
- ✅ 所有文件通过 linter 检查
- ✅ 无语法错误
- ✅ 无缩进错误

### 功能验证
- ✅ 字体大小参数正确传递
- ✅ 文档标题参数正确使用
- ✅ 批量处理逻辑正确
- ✅ 缓存重新生成逻辑正确

---

## 💡 使用建议

### 推荐配置

**标准质量（平衡）**：
- 截图DPI: 150
- 字体大小: 14pt
- 分栏数量: 2
- 栏间距: 20px

**高质量（演示用）**：
- 截图DPI: 200-250
- 字体大小: 16pt
- 分栏数量: 2
- 栏间距: 24px

**紧凑模式（打印）**：
- 截图DPI: 150
- 字体大小: 12pt
- 分栏数量: 3
- 栏间距: 16px

**大字模式（易读）**：
- 截图DPI: 150
- 字体大小: 18pt
- 分栏数量: 1
- 栏间距: N/A

---

## 🎉 改进总结

### 修复的问题
1. ✅ 文档标题参数现在正常工作
2. ✅ 字体大小可以自由调整
3. ✅ 参数布局更加紧凑

### 改进的体验
1. ✅ 更多控制权给用户
2. ✅ 更清晰的参数说明
3. ✅ 更好的空间利用

### 保持的兼容性
1. ✅ 默认值保持不变
2. ✅ API 接口不变
3. ✅ 功能完全兼容

---

## 📝 后续改进建议（可选）

1. **字体选择独立化**
   - 为 HTML 模式提供独立的字体选择
   - 不依赖 PDF 模式的"CJK 字体"配置

2. **行距独立化**
   - 为 HTML 模式提供独立的行距配置
   - 不依赖 PDF 模式的"讲解文本行距"配置

3. **预设配置**
   - 提供"标准"、"高质量"、"紧凑"、"易读"等预设
   - 一键切换参数组合

4. **实时预览**
   - 在配置参数时显示效果预览
   - 提高配置效率

---

**改进日期**：2025-11-06  
**修改文件**：2 个  
**新增功能**：字体大小配置  
**修复问题**：文档标题功能、参数布局优化

